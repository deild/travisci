language: minimal
stages:
  - test
  - name: 'deploy pages'
    if: branch = master
  - name: 'deploy release'
    if: tag IS present
jobs:
  include:
    - stage: 'deploy pages'
      script: sed -i -e "s/SHA/$TRAVIS_COMMIT/g" index.html
      deploy:
        provider: pages
        skip_cleanup: true
        github_token: $GITHUB_TOKEN
        keep_history: true
        committer_from_gh: true
        on:
          branch: master
    - stage: 'deploy release'
      script: sed -i -e "s/SHA/$TRAVIS_TAG/g" index.html
      deploy:
        provider: releases
        api_key: $GITHUB_TOKEN
        file: "index.html"
        skip_cleanup: true
        on:
          tags: true
script:
  - make test